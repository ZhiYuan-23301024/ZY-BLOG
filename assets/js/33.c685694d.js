(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{627:function(_,v,t){"use strict";t.r(v);var a=t(2),s=Object(a.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h2",{attrs:{id:"_1-什么是ssh隧道"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是ssh隧道"}},[_._v("#")]),_._v(" 1. 什么是SSH隧道？")]),_._v(" "),v("p",[_._v("SSH隧道（SSH Tunneling）是一种通过加密的SSH连接来传输其他网络协议数据的技术。它就像在您的应用程序和目标服务之间建立了一条"),v("strong",[_._v("加密的管道")]),_._v("，所有数据都通过这个安全通道传输。")]),_._v(" "),v("p",[_._v("在您的场景中：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("graph LR\n    A[您的Spring Boot应用] --\x3e B[SSH隧道 localhost:63333]\n    B --\x3e C[公网ECS 124.71.238.8:22]\n    C --\x3e D[内网数据库 192.168.0.43:5432]\n")])])]),v("h2",{attrs:{id:"_2-为什么需要ssh隧道访问数据库"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-为什么需要ssh隧道访问数据库"}},[_._v("#")]),_._v(" 2. 为什么需要SSH隧道访问数据库？")]),_._v(" "),v("h3",{attrs:{id:"_2-1-网络架构分析"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-网络架构分析"}},[_._v("#")]),_._v(" 2.1 网络架构分析")]),_._v(" "),v("p",[_._v("根据您提供的信息：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("​"),v("strong",[_._v("数据库服务器")]),_._v("​：192.168.0.43 (内网IP)")])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("公网ECS服务器")]),_._v("​：124.71.238.8 (公网IP)")])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("您的应用位置")]),_._v("​：外部网络（不在同一个内网）")])])]),_._v(" "),v("p",[_._v("这种架构下：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("graph TD\n    A[您的应用] --\x3e|无法直接访问| B[192.168.0.43]\n    A --\x3e|可以通过公网访问| C[124.71.238.8]\n    C --\x3e|内网可达| B\n")])])]),v("h3",{attrs:{id:"_2-2-需要ssh隧道的根本原因"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-需要ssh隧道的根本原因"}},[_._v("#")]),_._v(" 2.2 需要SSH隧道的根本原因")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("​"),v("strong",[_._v("数据库不暴露公网")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("数据库服务器192.168.0.43只有内网IP")])]),_._v(" "),v("li",[v("p",[_._v("无法从互联网直接访问")])]),_._v(" "),v("li",[v("p",[_._v("这是安全最佳实践（避免数据库直接暴露在公网）")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("安全访问机制")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("ECS服务器124.71.238.8是唯一有公网IP的入口")])]),_._v(" "),v("li",[v("p",[_._v("SSH提供加密认证通道")])]),_._v(" "),v("li",[v("p",[_._v("只有授权用户（您）可以通过SSH访问")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("网络隔离策略")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("企业/云环境通常采用网络隔离")])]),_._v(" "),v("li",[v("p",[_._v("数据库放在私有子网")])]),_._v(" "),v("li",[v("p",[_._v("应用服务器放在公有子网")])])])])]),_._v(" "),v("h2",{attrs:{id:"_3-ssh隧道的工作原理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-ssh隧道的工作原理"}},[_._v("#")]),_._v(" 3. SSH隧道的工作原理")]),_._v(" "),v("h3",{attrs:{id:"_3-1-本地端口转发-local-port-forwarding"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-本地端口转发-local-port-forwarding"}},[_._v("#")]),_._v(" 3.1 本地端口转发（Local Port Forwarding）")]),_._v(" "),v("p",[_._v("在您的场景中使用的技术：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("sequenceDiagram\n    participant App as 您的应用\n    participant Local as 本地机器\n    participant ECS as 公网ECS(124.71.238.8)\n    participant DB as 数据库(192.168.0.43)\n    \n    App->>Local: 连接localhost:63333\n    Local->>ECS: 通过SSH隧道转发\n    ECS->>DB: 访问192.168.0.43:5432\n    DB->>ECS: 返回数据\n    ECS->>Local: 通过SSH隧道返回\n    Local->>App: 返回数据\n")])])]),v("h3",{attrs:{id:"_3-2-技术细节"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-技术细节"}},[_._v("#")]),_._v(" 3.2 技术细节")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("​"),v("strong",[_._v("建立SSH连接")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("使用SSH客户端连接到ECS")])]),_._v(" "),v("li",[v("p",[_._v("认证通过后建立加密通道")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("端口绑定")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("SSH客户端在本地打开一个端口（如63333）")])]),_._v(" "),v("li",[v("p",[_._v("所有发往该端口的数据都被转发到ECS")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("目标重定向")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("ECS服务器将收到的数据转发到内网数据库")])]),_._v(" "),v("li",[v("p",[_._v("数据库响应通过相同路径返回")])])])])]),_._v(" "),v("h2",{attrs:{id:"_4-在spring-boot中的必要性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-在spring-boot中的必要性"}},[_._v("#")]),_._v(" 4. 在Spring Boot中的必要性")]),_._v(" "),v("h3",{attrs:{id:"_4-1-直接连接为什么不可行"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-直接连接为什么不可行"}},[_._v("#")]),_._v(" 4.1 直接连接为什么不可行？")]),_._v(" "),v("p",[_._v("如果尝试直接连接：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("// 这行代码会失败！\nspring.datasource.url=jdbc:postgresql://124.71.238.8:5432/hospital\n")])])]),v("p",[_._v("原因：")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("数据库不在124.71.238.8上")])]),_._v(" "),v("li",[v("p",[_._v("ECS的5432端口没有数据库服务")])]),_._v(" "),v("li",[v("p",[_._v("即使有，也不安全（未加密）")])])]),_._v(" "),v("h3",{attrs:{id:"_4-2-ssh隧道的优势"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-ssh隧道的优势"}},[_._v("#")]),_._v(" 4.2 SSH隧道的优势")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("​"),v("strong",[_._v("安全性")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("所有传输数据加密")])]),_._v(" "),v("li",[v("p",[_._v("数据库不暴露在公网")])]),_._v(" "),v("li",[v("p",[_._v("通过SSH密钥/密码认证")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("网络穿透")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("穿透内网边界")])]),_._v(" "),v("li",[v("p",[_._v("无需修改网络架构")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("最小权限原则")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("只有授权用户可建立隧道")])]),_._v(" "),v("li",[v("p",[_._v("数据库只需对ECS开放")])])])])]),_._v(" "),v("h2",{attrs:{id:"_5-您的具体实现方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-您的具体实现方案"}},[_._v("#")]),_._v(" 5. 您的具体实现方案")]),_._v(" "),v("h3",{attrs:{id:"_5-1-配置核心要素"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置核心要素"}},[_._v("#")]),_._v(" 5.1 配置核心要素")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("组件")]),_._v(" "),v("th",[_._v("配置项")]),_._v(" "),v("th",[_._v("值")]),_._v(" "),v("th",[_._v("说明")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("​"),v("strong",[_._v("SSH隧道")]),_._v("​")]),_._v(" "),v("td",[_._v("ssh.tunnel.host")]),_._v(" "),v("td",[_._v("124.71.238.8")]),_._v(" "),v("td",[_._v("公网ECS地址")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("ssh.tunnel.port")]),_._v(" "),v("td",[_._v("22")]),_._v(" "),v("td",[_._v("SSH标准端口")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("ssh.tunnel.username")]),_._v(" "),v("td",[_._v("root")]),_._v(" "),v("td",[_._v("ECS登录用户")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("ssh.tunnel.password")]),_._v(" "),v("td",[_._v("HGY25qiu@shixun")]),_._v(" "),v("td",[_._v("ECS登录密码")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("ssh.tunnel.local-port")]),_._v(" "),v("td",[_._v("63333")]),_._v(" "),v("td",[_._v("本地隧道入口")])]),_._v(" "),v("tr",[v("td",[_._v("​"),v("strong",[_._v("数据库")]),_._v("​")]),_._v(" "),v("td",[_._v("spring.datasource.url")]),_._v(" "),v("td",[_._v("jdbc:...localhost:63333")]),_._v(" "),v("td",[_._v("指向隧道入口")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("spring.datasource.username")]),_._v(" "),v("td",[_._v("root")]),_._v(" "),v("td",[_._v("数据库用户")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("spring.datasource.password")]),_._v(" "),v("td",[_._v("HGY25qiu@shixun")]),_._v(" "),v("td",[_._v("数据库密码")])])])]),_._v(" "),v("h3",{attrs:{id:"_5-2-工作流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-工作流程"}},[_._v("#")]),_._v(" 5.2 工作流程")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("graph TB\n    A[Spring Boot启动] --\x3e B[初始化SSH隧道]\n    B --\x3e C[建立到124.71.238.8的SSH连接]\n    C --\x3e D[绑定本地63333端口]\n    D --\x3e E[配置数据库连接]\n    E --\x3e F[应用通过localhost:63333访问]\n    F --\x3e G[流量经SSH隧道加密传输]\n    G --\x3e H[ECS解密并转发到192.168.0.43]\n    H --\x3e I[数据库处理请求]\n    I --\x3e H[返回响应]\n    H --\x3e G[加密返回]\n    G --\x3e F[应用接收响应]\n")])])]),v("h2",{attrs:{id:"_6-生产环境建议"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_6-生产环境建议"}},[_._v("#")]),_._v(" 6. 生产环境建议")]),_._v(" "),v("h3",{attrs:{id:"_6-1-安全增强措施"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-安全增强措施"}},[_._v("#")]),_._v(" 6.1 安全增强措施")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("​"),v("strong",[_._v("使用SSH密钥替代密码")]),_._v("​：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("ssh-keygen -t rsa -b 4096 -f deploy_key\n")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("限制ECS用户权限")]),_._v("​：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("# 创建专用用户\nadduser db_tunnel_user\n")])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("数据库网络隔离")]),_._v("​：")]),_._v(" "),v("ul",[v("li",[_._v("配置安全组只允许ECS访问")])])])]),_._v(" "),v("h3",{attrs:{id:"_6-2-高可用方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-高可用方案"}},[_._v("#")]),_._v(" 6.2 高可用方案")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("​"),v("strong",[_._v("隧道监控")]),_._v("​：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v('@Scheduled(fixedRate = 30000)\npublic void checkTunnel() {\n    if (!tunnelConfig.isActive()) {\n        logger.warn("SSH隧道断开，尝试重连...");\n        tunnelConfig.reconnect();\n    }\n}\n')])])])]),_._v(" "),v("li",[v("p",[_._v("​"),v("strong",[_._v("双隧道备份")]),_._v("​：")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("# 主隧道\nssh.tunnel.primary.host=124.71.238.8\n\n# 备用隧道\nssh.tunnel.backup.host=backup.ecs.com\n")])])])])]),_._v(" "),v("h2",{attrs:{id:"_7-替代方案比较"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_7-替代方案比较"}},[_._v("#")]),_._v(" 7. 替代方案比较")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("方案")]),_._v(" "),v("th",[_._v("优点")]),_._v(" "),v("th",[_._v("缺点")]),_._v(" "),v("th",[_._v("适用场景")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("​"),v("strong",[_._v("SSH隧道")]),_._v("​")]),_._v(" "),v("td",[_._v("简单易用、加密传输")]),_._v(" "),v("td",[_._v("单点故障、性能开销")]),_._v(" "),v("td",[_._v("开发测试、小型应用")])]),_._v(" "),v("tr",[v("td",[_._v("​"),v("strong",[_._v("VPN")]),_._v("​")]),_._v(" "),v("td",[_._v("全网络加密、高可用")]),_._v(" "),v("td",[_._v("配置复杂、成本高")]),_._v(" "),v("td",[_._v("企业级生产环境")])]),_._v(" "),v("tr",[v("td",[_._v("​"),v("strong",[_._v("数据库公网访问")]),_._v("​")]),_._v(" "),v("td",[_._v("直接连接")]),_._v(" "),v("td",[_._v("极不安全、易受攻击")]),_._v(" "),v("td",[_._v("不推荐使用")])]),_._v(" "),v("tr",[v("td",[_._v("​"),v("strong",[_._v("云平台VPC对等")]),_._v("​")]),_._v(" "),v("td",[_._v("高性能、安全")]),_._v(" "),v("td",[_._v("云平台锁定、配置复杂")]),_._v(" "),v("td",[_._v("云原生应用")])])])]),_._v(" "),v("h2",{attrs:{id:"结论"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[_._v("#")]),_._v(" 结论")]),_._v(" "),v("p",[_._v("在您的场景中，使用SSH隧道是访问内网数据库的"),v("strong",[_._v("最合理方案")]),_._v("，因为它：")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("解决了内网数据库不可达的问题")])]),_._v(" "),v("li",[v("p",[_._v("提供了加密的安全通道")])]),_._v(" "),v("li",[v("p",[_._v("无需修改现有网络架构")])]),_._v(" "),v("li",[v("p",[_._v("与Spring Boot集成简单")])])]),_._v(" "),v("p",[_._v("通过配置SSH隧道，您的Spring Boot应用可以安全地访问位于内网的PostgreSQL数据库，同时保持数据库本身不暴露在公网环境中，符合安全最佳实践。")])])}),[],!1,null,null,null);v.default=s.exports}}]);